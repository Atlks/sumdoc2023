bk web3 amm


 

（如果你已经熟悉 Uniswap 和自动化做市商，即 AMM，请跳过下面章节，直接阅读「AMM 的寒武纪爆发」）给新手们普及一下：Uniswap 是一个自动做市商，即 AMM。你可以把 AMM 设想成一个原始的、机器人式的做市商，它根据一个简单的定价算法，在两种资产之间随时提供报价。对 Uniswap 而言，它对这两种资产进行报价，其持有的每种资产的单位数相乘，总会等于一个常数。这听上去有些拗口：如果 Uniswap 拥有一些 x 代币，拥有一些 y 代币，它给每一笔交易定价，所以，它拥有的 x 的最终数量，和拥有的 y 的最终数量，两者相乘会等于一个常数 k。这就形成了一个常数积的等式：x * y = k。这种对两种资产进行定价的方式，你可能会觉得非常怪异且过于独断。让两种代币的库存数相乘所得的积维持固定，为什么就能确保正确的报价呢？Uniswap 示例假设我们在 Uniswap 的某个池里投入 50 个苹果 （a） 和 50 个香蕉 （b） ，任何人都可以用苹果换香蕉，或者用香蕉换苹果。假设一级市场中苹果与香蕉的汇率刚好是 1:1。因为该 Uniswap 资金池中分别有 50 个苹果和 50 个香蕉，因此，按上述常数积的等式规则，a * b = 2500 。对于任何交易，Uniswap 都需要保证，池中库存的苹果数和香蕉数相乘等于 2500。好了，假设一位客户进入我们的 Uniswap 池来买一个苹果。她应该支付多少个香蕉呢？如果她买走一个苹果，我们的池里就剩下 49 个苹果，而 49* b 依然需要等于 2500。这样香蕉的总数 b 就等于 51.02。由于之前池中有 50 个香蕉，因此我们还需要 1.02 个香蕉（在这个宇宙中我们允许碎片化香蕉的存在） ，因此，这位客户买一个苹果会得到的报价是：1.02 香蕉 / 苹果。请注意，这与两者之间 1:1


如果她想买 10 个苹果， Uniswap 的报价会是 12.5 个香蕉，即这 10 个苹果每个的单价为 1.25 香蕉 / 苹果。如果她想要执行 25 个苹果这种大额交易，即要买库存苹果数量的一半，那么，单位价格会上涨到 2 香蕉 / 苹果！ （你能从直觉上明白这一点，因为池中的一种商品减半，另一种就得翻倍）重要的是需要明白，Uniswap 不能偏离这条定价曲线。如果某人要购买一些苹果，后来又有人要买一些香蕉， Uniswap 就会在这条价格曲线上来回移动，无论需求把它带向何方。

这里有个好玩的地方：如果苹果与香蕉之间的真实交易价格是 1:1，当第一位客户买走 10 个苹果后，我们 Uniswap 池就有会变成 40 个苹果和 62.5 个香蕉。如果有位套利者此时进入，她买走 12.5 个香蕉，让资金池恢复到最初状态，她只需付 10 个苹果，所以 Uniswap 对她的收费只有 0.8 苹果 / 香蕉。Uniswap 会低价甩卖香蕉！就好像我们的算法此时意识到香蕉过多，所以它低价抛售香蕉，以吸引苹果流入，从而实现库存的再平衡。Uniswap 经常跳这种舞步——稍微偏离真实的交易价格，然后在套利者的帮助下缓步回归正常。套利损失（Impermanent Loss）简介下面你将了解 Uniswap 定价机制的工作方式。但这仍然引出一个问题——Uniswap 很好的完成了它工作吗？这东西真的会产生利润吗？毕竟，任何做市商都可以报价，但是否赚钱就不好说了。

假设某家香蕉农场遭遇了无人机攻击，出现大面积的香蕉短缺。香蕉现在像黄金一样贵。交易价格蹿升到 5 个苹果换 1 个香蕉。Uniswap 上会发生什么？套利者一秒都不会耽搁，立马杀入你的 Uniswap 池，抢购便宜的香蕉。他们调整交易规模，以便买走价格低于新汇率 5:1 的所有香蕉。这意味着他们需要移动价格曲线，直到满足以下等式：5x * x = 2500。

他们的利润从何而来？当然这是以牺牲资金池为代价的！而且，如果数一下你会发现，与某个持有最初的 50 个苹果和 50 个香蕉的人相比，Uniswap 池现在恰好下降了 76.4 个苹果的价值。Uniswap 出售香蕉的价格太便宜，因为它不知道香蕉在现实世界中变得如此值钱。

这种现象称为「套利 损失」。每当交易价格发生变动，就会出现套利者窃取廉价资产，直到资金池的定价达到正确为止。 （这些损失是「暂时的」，因为如果后来真实交易价格恢复为 1：1，那么就好像你从未损失过这笔钱，和开始相比。）



自 2018 年上线以来， Uniswap 已经席卷 DeFi 领域。考虑到 Uniswap 的原始版本只有大约 300 行代码，这一成绩尤其令人惊讶！ （AMM 本身拥有历史悠久的血统，但是常数函数做市商是一个相对较新的发明。） Uniswap 完全无需许可，任何人都可以注入资产。它甚至不需要预言机

相互关联的交易对，其价格往往一起移动，因此 Uniswap 不会有太多套利损失。



想象一下，有人在某个预测市场做多特朗普，做多拜登，并将两笔押注放入 Uniswap 的一个资金池。从定义上说，最终将有一笔资产值 1 美元，另一笔资产则为 0。该资金池的结果是，某个 LP 一无所获，只有套利损失！ （预测市场总是在市场结清之前停止交易，但结果往往早在市场真正结清之前已经水落石出。）所以 ，Uniswap 对某些交易对运转良好，而对另一些交易对而言就是灾难。但是人们很容易发现，到目前为止，几乎所有头部 Uniswap 资金池都是赚钱的！实际上，甚至 ETH / DAI 资金池自创建以来也是赚钱的。

同样的原则也适用于 Uniswap。有些人在 Uniswap 交易，因为他们完全是随机的想用 ETH 换 DAI 。对做市商而言，这是不知情的散户流，随机漫步的交易活动会带来费用收入。这很爽。你面对的还有套利者：他们是知情订单流。他们在选择价格错误的资金池。某种程度上说，他们其实是在帮助 Uniswap 将交易价格拉回正轨。但另一方面，他们是把 LP 的钱转移到他们自己的兜里

从订单簿到 AMM我相信，Uniswap 之所以击败订单簿交易所，有四个原因。首先，Uniswap 的实施极其简单。这意味着复杂性低、遭遇黑客攻击的表面积低、集成成本低。更何况，它有很低的 gas 成本！当你在一个相当于去中心化的图形计算器上执行所有交易时，这一点真的很重要。

Uniswap 之所以如此成功的最后一个原因是，创建带激励的资金池非常方便。在一个带激励的资金池中，资金池的创建者将代币空投给 LP，使 LP 得到的回报高于 Uniswap 标准回报。这种现象也被称为「流动性农场」 （liquidity farming） 。

AMM从根本上改变了用户交易加密货币的方式。交易的双方都没有使用传统的买卖订单簿，而是由链上流动性池预先提供资金。流动性池允许用户以完全去中心化和非托管的方式在链上进行无缝的代币兑换。根据流动性提供者对资金池的贡献百分比，他们可以通过获得相应的交易费收入


恒定函数做市商（CFMM） 是最受欢迎的一类AMM，专门为实现数字资产的去中心化交易而设计的。这些AMM交易所基于恒定函数，交易对的综合资产储备必须保持不变。在非托管式AMM中，各个交易对的用户保证金被集中在一个智能合约内，任何交易者都可以利用该合约进行代币兑换。因此，用户是与智能合约（集合资产）进行交易，而不是像在订单簿交易所那样直接与对手方进行交易。

但 AMM 并非严格意义上的完美方案，它确实存在一些限制，例如低资金利用率、额外的风险敞口、以及受到广泛讨论的无常损失问题。流动性提供者 (LP) 已经意识到了做市是有风险的，而且可能出现无常损失。出现这种“损失”的原因是 LP 只需要把他们的资产存放在钱包里就可能获得更高的价值。

尽管 AMM 本身已经帮助实现了流动性供给的民主化，当前的模型依旧需要进一步的创新，才能更契合 DeFi 的精神。


在 AMM 发挥作用之前，流动性是以太坊上去中心化交易所(DEX) 面临的挑战。作为一种界面复杂的新技术，买卖双方的数量都很少，这意味着很难找到足够的人愿意定期进行交易。


'
DeFi 生态系统发展迅速，但已经出现了三种占主导地位的 AMM 模型：Uniswap、Curve和Balancer。Uniswap 的开创性技术允许用户用任何一对 ERC-20 Token以 50/50 的比例创建流动性池，并已成为以太坊上最持久的 AMM 模型。Curve 专注于创建稳定币等类似资产的流动性池，因此在解决流动性有限问题的同时，提供业内最低的利率和最高效的交易。Balancer 允许用户以任意比例创建多达八种不同资产的动态流动资金池，从而扩展了 Uniswap 的限制，从而扩展了 AMM 的灵活性。

作者：方块研究所Cube
链接：https://www.zhihu.com/question/406610359/answer/2828853960
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。