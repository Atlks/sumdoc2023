排查问题思路与步骤 根据

<!-- TOC -->

- [监控和日志](#监控和日志)
    - [sql日志 尽可能使用db提供的日志根据。。代码日志比较麻烦](#sql日志-尽可能使用db提供的日志根据代码日志比较麻烦)
    - [trig劫持法](#trig劫持法)
    - [分析业务流程 sql  整个调用栈](#分析业务流程-sql--整个调用栈)
    - [dump目前状态。。。](#dump目前状态)
    - [web log](#web-log)
    - [利用 标准的运维工具代替这些后门。  查询](#利用-标准的运维工具代替这些后门--查询)
    - [抓包 vs 线上dbg](#抓包-vs-线上dbg)
- [逻辑推理 实用](#逻辑推理-实用)
    - [定时释放资源法 php法](#定时释放资源法-php法)
    - [L2 侧链方案](#l2-侧链方案)
    - [小范围重构](#小范围重构)
- [other](#other)
- [必要时反编译 class 文件](#必要时反编译-class-文件)
- [麻烦 代码走查](#麻烦-代码走查)

<!-- /TOC -->

#监控和日志
##  sql日志 尽可能使用db提供的日志根据。。代码日志比较麻烦


 
      需要查看sql日志。。。。看它是否是同一条数据sql 。。。

 
 查看日志状态和sql日志路径
 SHOW VARIABLES LIKE "general_log%";

 打开mysql的sql日志
 SET GLOBAL general_log = 'ON';

 
在我本机测试同样报 DUPLICATE KEY的时候是可以查看到sql日志的

## trig劫持法

## 分析业务流程 sql  整个调用栈
sql决定业务流程




## dump目前状态。。。

## web log

## 利用 标准的运维工具代替这些后门。  查询 

## 抓包 vs 线上dbg

# 逻辑推理 实用

 
## 定时释放资源法 php法
 

但很多大神的解决步骤是：第一，听别人讲述问题现象；第二，提出问题以求证；第三，推理出大致原因并给出可选方案及方案的注意点；第四，自己、更多情况下是他人进行验证。为啥是他人，能达到这种境界多是领导或者帮别人排查问题的救火队长，问题发生和自己并没有直接关系。
## L2 侧链方案 
## 小范围重构

# other

# 必要时反编译 class 文件


3 检查数据库锁，CPU.磁盘网络 io.jstack 查看线程阻塞情况，jmap 查看内存信息



问题复现

这个不用多解释，聊聊复现的步骤：

● 确保所有的步骤都被记录。记录下所做的每一件事、每一个步骤、每一个停顿。无意间丢失一个步骤或者增加一个多余步骤，可能导致无法再现软件缺陷。在尝试运行测试用例时，可以利用录制工具确切地记录执行步骤。所有的目标是确保导致软件缺陷所需的全部细节是可见的。



# 麻烦 代码走查

 

 

排查问题的最高境界是只通过review代码来发现问题

 
